(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-42",headers:{authorization:"96d12da8-783c-4e5b-be9a-7b51dd944b65","Content-Type":"application/json"}},t=function(){return fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},n=document.querySelector("#card-template").content;function o(t,n,o){console.log("Отправляем запрос с параметрами:",t,n),function(t,n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:n?"DELETE":"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t,n).then((function(e){console.log("Ответ сервера:",e),o(e)})).catch((function(e){console.error("Ошибка при toggle like:",e)}))}function r(e,t,r,c,u,i){var a=n.querySelector(".card").cloneNode(!0),p=a.querySelector(".card__delete-button"),s=a.querySelector(".card__like-button"),l=a.querySelector(".card__image"),d=a.querySelector(".card__title"),_=a.querySelector(".card__image"),f=a.querySelector(".card__likes-count");function y(e){if(console.log("Полученные данные для обновления лайков:",e),e.likes){var t=e.likes.map((function(e){return e._id})).includes(u);s.classList.toggle("card__like-button_is-active",t),f.textContent=e.likes.length}else f.textContent=0}return l.src=e.link,d.textContent=e.name,_.alt="Название места: ".concat(e.name),l.addEventListener("click",(function(){return r(e)})),y(e),e.owner._id===u?p.style.display="block":p.style.display="none",p.addEventListener("click",(function(){i(e._id,a)})),s.addEventListener("click",(function(){o(e._id,s.classList.contains("card__like-button_is-active"),y),s.classList.toggle("card__like-button_is-active")})),a}var c=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");i(t)}},u=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keyup",c)},i=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",c)},a=function(e){e.querySelector(".popup__close").addEventListener("click",(function(){i(e)})),e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&i(e)}))},p=document.querySelector(".popup__form"),s=p.querySelector(".popup__input");function l(e,t){e.every((function(e){return e.validity.valid}))?t.classList.remove("popup__button_disabled"):t.classList.add("popup__button_disabled")}function d(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector));n.forEach((function(t){v(e,t),t.setCustomValidity("")})),l(n,e.querySelector(t.submitButtonSelector))}p.querySelector(".".concat(s.id,"-error"));var _,f,y,m=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),o.textContent=n,o.classList.add("popup__error_visible")},v=function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.classList.remove("popup__error_visible"),n.textContent=""},h=document.querySelector(".places__list"),S=document.querySelector(".popup_type_edit"),b=document.querySelector(".profile__edit-button"),q=document.querySelector(".popup_type_new-card"),k=document.querySelector(".profile__add-button"),L=document.querySelector(".popup__form-profile"),E=document.querySelector(".popup__form-card"),g=document.querySelector(".popup_type_image"),C=g.querySelector(".popup__image"),j=g.querySelector(".popup__caption"),x=document.querySelector(".profile__title"),P=document.querySelector(".profile__description"),U=E.querySelector(".popup__input_type_card-name"),A=E.querySelector(".popup__input_type_url"),B=L.querySelector(".popup__input_type_name"),T=L.querySelector(".popup__input_type_description"),D=document.querySelector(".popup_type_delete"),w=D.querySelector(".popup__button_delete"),N=document.querySelector(".profile__image"),O=document.querySelector(".profile__edit-avatar"),J=document.querySelector(".popup_type-avatar"),M=document.querySelector(".popup__form-avatar"),V=M.querySelector(".popup__input_type_url"),H=M.querySelector(".popup__button"),I=L.querySelector(".popup__button"),z=E.querySelector(".popup__button");function F(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранить";t?(e.textContent=n,e.disabled=!0):(e.textContent=o,e.disabled=!1)}function G(e){C.src=e.link,C.alt=e.name,j.textContent=e.name,u(g)}function K(t){t.preventDefault();var n,o,r=B.value,c=T.value;F(I,!0),(n=r,o=c,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){x.textContent=e.name,P.textContent=e.about,i(S)})).catch((function(e){console.error("Ошибка при обновлении данных пользователя:",e)})).finally((function(){F(I,!1)}))}function Q(t){t.preventDefault();var n=U.value,o=A.value;F(z,!0),function(t,n){return fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n,o).then((function(e){var t=r(e,0,G,0,y,R);h.prepend(t),i(q),E.reset(),d(E,{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled"})})).catch((function(e){return console.error("Ошибка при добавлении карточки:",e)})).finally((function(){F(z,!1)}))}function R(e,t){_=t,f=e,u(D)}b.addEventListener("click",(function(){F(I,!1)})),k.addEventListener("click",(function(){F(z,!1)})),O.addEventListener("click",(function(){F(H,!1)})),a(S),a(q),a(g),a(D),a(J),b.addEventListener("click",(function(){d(L,{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled"}),u(S);var e=document.querySelector(".profile__title").textContent,t=document.querySelector(".profile__description").textContent;B.value=e,T.value=t,L.addEventListener("submit",K)})),k.addEventListener("click",(function(){u(q),E.addEventListener("submit",Q)})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");t.forEach((function(o){o.addEventListener("input",(function(){(function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?v(e,t):m(e,t,t.validationMessage)})(e,o),l(t,n)}))}))}(e)})),t().then((function(e){y=e._id})).catch((function(e){return console.error("Ошибка при загрузке данных пользователя:",e)})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t=r(e,0,G,0,y,R);h.append(t)}))})).catch((function(e){return console.error("Ошибка при загрузке данных карточек:",e)})),w.addEventListener("click",(function(){var t;_&&f&&(t=f,fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){_.remove(),i(D)})).catch((function(e){return console.error("Ошибка при удалении карточки:",e)}))})),O.addEventListener("click",(function(){M.reset(),d(M,{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}),u(J)})),M.addEventListener("submit",(function(t){t.preventDefault();var n=V.value;F(H,!0),function(t){return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n).then((function(e){N.style.backgroundImage="url('".concat(e.avatar,"')"),i(J),M.reset()})).catch((function(e){console.error("Ошибка загрузки аватара: "+e)})).finally((function(){F(H,!1)}))})),t().then((function(e){y=e._id,N.style.backgroundImage="url('".concat(e.avatar,"')"),x.textContent=e.name,P.textContent=e.about})).catch((function(e){return console.error("Ошибка при загрузке данных пользователя:",e)}))})();